(function e(r,t,n){function o(s,a){if(!t[s]){if(!r[s]){var u=typeof require=="function"&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var d=t[s]={exports:{}};r[s][0].call(d.exports,function(e){var t=r[s][1][e];return o(t?t:e)},d,d.exports,e,r,t,n)}return t[s].exports}var i=typeof require=="function"&&require;for(var s=0;s<n.length;s++)o(n[s]);return o})({1:[function(e,r,t){var n,o,i,s=function(e,r){return function(){return e.apply(r,arguments)}};i=e("browser-request");n=function(){function e(){this.onMessage=s(this.onMessage,this)}e.prototype.onMessage=function(e){var r;this.source=e.source;this.origin=e.origin;try{r=JSON.parse(e.data)}catch(e){return}this.id=r.id;return this[r.name](e,r)};e.prototype.prepare=function(e,r){$$runtime.form=r.form;$$runtime.script=r.form.script;$$prepare();this.setupHostFunctions();return this.respond({name:"prepare"})};e.prototype.expressions=function(e,r){$$runtime.expressions=r.expressions;return this.respond({name:"expressions"})};e.prototype.values=function(e,r){var t;$$runtime.values=r.values||{};if(r.customVariables){$$runtime.customVariables=r.customVariables}if(r.featureVariables){for(t in r.featureVariables){$$runtime[t]=r.featureVariables[t]}}return this.respond({name:"values"})};e.prototype.globals=function(e,r){var t;for(t in r.globals){$$runtime[t]=r.globals[t]}return this.respond({name:"globals"})};e.prototype.evaluate=function(e,r){var t;t=$$evaluate();return this.respond({name:"evaluate",results:t})};e.prototype.triggerDataEvent=function(e,r){var t;$$runtime.event=r.event||null;t=$$trigger();return this.respond({name:"triggerDataEvent",results:t})};e.prototype.finishAsyncCallback=function(e,r){var t;$$runtime.callbackID=r.callbackID||null;$$runtime.callbackArguments=r.callbackArguments||[];t=$$finishAsync();return this.respond({name:"finishAsyncCallback",results:t})};e.prototype.respond=function(e){var r,t;try{if(e.id==null){e.id=this.id}t=JSON.stringify(e)}catch(n){r=n;t=null;console.log("Error sending object",e)}return this.source.postMessage(t,this.origin)};e.prototype.httpRequest=function(e,r){delete r.options.followRedirect;return i(r.options,function(e){return function(t,n,o){return e.respond({id:r.id,name:"httpRequest",result:[t,n,o]})}}(this))};e.prototype.setupHostFunctions=function(){$$runtime["$$httpRequest"]=function(e){return function(r,t){return e.respond({name:"hostFunction",functionName:"httpRequest",argumentList:[r,t]})}}(this);$$runtime["$$messageBox"]=function(e){return function(r,t){return e.respond({name:"hostFunction",functionName:"messageBox",argumentList:[r,t]})}}(this);return $$runtime["$$setTimeout"]=function(e){return function(r,t){return e.respond({name:"hostFunction",functionName:"setTimeout",argumentList:[r,t]})}}(this)};return e}();o=new n;if(window.addEventListener){window.addEventListener("message",o.onMessage.bind(o),false)}else{window.attachEvent("message",function(e){return o.onMessage(e)})}},{"browser-request":2}],2:[function(e,r,t){(function(e,n){if(typeof define==="function"&&define.amd){define([],n)}else if(typeof t==="object"){r.exports=n()}else{e.returnExports=n()}})(this,function(){var e=XMLHttpRequest;if(!e)throw new Error("missing XMLHttpRequest");t.log={trace:s,debug:s,info:s,warn:s,error:s};var r=3*60*1e3;function t(e,r){if(typeof r!=="function")throw new Error("Bad callback given: "+r);if(!e)throw new Error("No options given");var n=e.onResponse;if(typeof e==="string")e={uri:e};else e=JSON.parse(JSON.stringify(e));e.onResponse=n;if(e.verbose)t.log=a();if(e.url){e.uri=e.url;delete e.url}if(!e.uri&&e.uri!=="")throw new Error("options.uri is a required argument");if(typeof e.uri!="string")throw new Error("options.uri must be a string");var i=["proxy","_redirectsFollowed","maxRedirects","followRedirect"];for(var u=0;u<i.length;u++)if(e[i[u]])throw new Error("options."+i[u]+" is not supported");e.callback=r;e.method=e.method||"GET";e.headers=e.headers||{};e.body=e.body||null;e.timeout=e.timeout||t.DEFAULT_TIMEOUT;if(e.headers.host)throw new Error("Options.headers.host is not supported");if(e.json){e.headers.accept=e.headers.accept||"application/json";if(e.method!=="GET")e.headers["content-type"]="application/json";if(typeof e.json!=="boolean")e.body=JSON.stringify(e.json);else if(typeof e.body!=="string")e.body=JSON.stringify(e.body)}var f=function(e){var r=[];for(var t in e)if(e.hasOwnProperty(t)){r.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]))}return r.join("&")};if(e.qs){var c=typeof e.qs=="string"?e.qs:f(e.qs);if(e.uri.indexOf("?")!==-1){e.uri=e.uri+"&"+c}else{e.uri=e.uri+"?"+c}}var p=function(e){var r={};r.boundry="-------------------------------"+Math.floor(Math.random()*1e9);var t=[];for(var n in e){if(e.hasOwnProperty(n)){t.push("--"+r.boundry+"\n"+'Content-Disposition: form-data; name="'+n+'"'+"\n"+"\n"+e[n]+"\n")}}t.push("--"+r.boundry+"--");r.body=t.join("");r.length=r.body.length;r.type="multipart/form-data; boundary="+r.boundry;return r};if(e.form){if(typeof e.form=="string")throw"form name unsupported";if(e.method==="POST"){var l=(e.encoding||"application/x-www-form-urlencoded").toLowerCase();e.headers["content-type"]=l;switch(l){case"application/x-www-form-urlencoded":e.body=f(e.form).replace(/%20/g,"+");break;case"multipart/form-data":var h=p(e.form);e.body=h.body;e.headers["content-type"]=h.type;break;default:throw new Error("unsupported encoding:"+l)}}}e.onResponse=e.onResponse||s;if(e.onResponse===true){e.onResponse=r;e.callback=s}if(!e.headers.authorization&&e.auth)e.headers.authorization="Basic "+d(e.auth.username+":"+e.auth.password);return o(e)}var n=0;function o(r){var o=new e,i=false,s=f(r.uri),a="withCredentials"in o;n+=1;o.seq_id=n;o.id=n+": "+r.method+" "+r.uri;o._id=o.id;if(s&&!a){var u=new Error("Browser does not support cross-origin request: "+r.uri);u.cors="unsupported";return r.callback(u,o)}o.timeoutTimer=setTimeout(d,r.timeout);function d(){i=true;var e=new Error("ETIMEDOUT");e.code="ETIMEDOUT";e.duration=r.timeout;t.log.error("Timeout",{id:o._id,milliseconds:r.timeout});return r.callback(e,o)}var c={response:false,loading:false,end:false};o.onreadystatechange=p;o.open(r.method,r.uri,true);if(s)o.withCredentials=!!r.withCredentials;o.send(r.body);return o;function p(n){if(i)return t.log.debug("Ignoring timed out state change",{state:o.readyState,id:o.id});t.log.debug("State change",{state:o.readyState,id:o.id,timed_out:i});if(o.readyState===e.OPENED){t.log.debug("Request started",{id:o.id});for(var s in r.headers)o.setRequestHeader(s,r.headers[s])}else if(o.readyState===e.HEADERS_RECEIVED)l();else if(o.readyState===e.LOADING){l();h()}else if(o.readyState===e.DONE){l();h();m()}}function l(){if(c.response)return;c.response=true;t.log.debug("Got response",{id:o.id,status:o.status});clearTimeout(o.timeoutTimer);o.statusCode=o.status;if(s&&o.statusCode==0){var e=new Error("CORS request rejected: "+r.uri);e.cors="rejected";c.loading=true;c.end=true;return r.callback(e,o)}r.onResponse(null,o)}function h(){if(c.loading)return;c.loading=true;t.log.debug("Response body loading",{id:o.id})}function m(){if(c.end)return;c.end=true;t.log.debug("Request done",{id:o.id});o.body=o.responseText;if(r.json){try{o.body=JSON.parse(o.responseText)}catch(e){return r.callback(e,o)}}r.callback(null,o,o.body)}}t.withCredentials=false;t.DEFAULT_TIMEOUT=r;t.defaults=function(e,r){var n=function(r){var t=function(t,n){if(typeof t==="string")t={uri:t};else{t=JSON.parse(JSON.stringify(t))}for(var o in e){if(t[o]===undefined)t[o]=e[o]}return r(t,n)};return t};var o=n(t);o.get=n(t.get);o.post=n(t.post);o.put=n(t.put);o.head=n(t.head);return o};var i=["get","put","post","head"];i.forEach(function(e){var r=e.toUpperCase();var n=e.toLowerCase();t[n]=function(e){if(typeof e==="string")e={method:r,uri:e};else{e=JSON.parse(JSON.stringify(e));e.method=r}var n=[e].concat(Array.prototype.slice.apply(arguments,[1]));return t.apply(this,n)}});t.couch=function(e,r){if(typeof e==="string")e={uri:e};e.json=true;if(e.body)e.json=e.body;delete e.body;r=r||s;var n=t(e,o);return n;function o(e,t,n){if(e)return r(e,t,n);if((t.statusCode<200||t.statusCode>299)&&n.error){e=new Error("CouchDB error: "+(n.error.reason||n.error.error));for(var o in n)e[o]=n[o];return r(e,t,n)}return r(e,t,n)}};function s(){}function a(){var e={},r=["trace","debug","info","warn","error"],t,n;for(n=0;n<r.length;n++){t=r[n];e[t]=s;if(typeof console!=="undefined"&&console&&console[t])e[t]=u(console,t)}return e}function u(e,r){return t;function t(t,n){if(typeof n==="object")t+=" "+JSON.stringify(n);return e[r].call(e,t)}}function f(e){var r=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;var t;try{t=location.href}catch(e){t=document.createElement("a");t.href="";t=t.href}var n=r.exec(t.toLowerCase())||[],o=r.exec(e.toLowerCase());var i=!!(o&&(o[1]!=n[1]||o[2]!=n[2]||(o[3]||(o[1]==="http:"?80:443))!=(n[3]||(n[1]==="http:"?80:443))));return i}function d(e){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var t,n,o,i,s,a,u,f,d=0,c=0,p="",l=[];if(!e){return e}do{t=e.charCodeAt(d++);n=e.charCodeAt(d++);o=e.charCodeAt(d++);f=t<<16|n<<8|o;i=f>>18&63;s=f>>12&63;a=f>>6&63;u=f&63;l[c++]=r.charAt(i)+r.charAt(s)+r.charAt(a)+r.charAt(u)}while(d<e.length);p=l.join("");switch(e.length%3){case 1:p=p.slice(0,-2)+"==";break;case 2:p=p.slice(0,-1)+"=";break}return p}return t})},{}]},{},[1]);
